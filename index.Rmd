---
title: "R Mini Course"
author: "Nicole Kinlock"
date: 10 June 2024
output:
  revealjs::revealjs_presentation:
    theme: night
    highlight: breezedark
    transition: fade
    center: false
---

## About this course

This course was developed by Ben Weinstein (2014), Mike McCann (2015), and Nicole Kinlock (2016, 2017) to be a workshop in the Department of Ecology & Evolution at Stony Brook University

```{r, echo = FALSE}
library(knitr)
opts_knit$set(global.par = TRUE)
```

---

## Directory

- Part 1: <a href = "#/3"> Basics of R </a>
- Part 2: <a href = "#/43"> Probability & distributions </a>
- Part 3: <a href = "#/61"> Data manipulation </a>
- Part 4: <a href = "#/94"> Looping and vectorization </a>
- Part 5: <a href = "#/131"> Functions </a>
- Part 6: <a href = "#/144"> Data visualization using ggplot2 </a>

---

## <b>Part 1:</b> Basics of R

<a href = "#/2">Back to the directory</a>

---

## Introduction to R

- Statistical programming language and environment
- Available as public domain software <i>(i.e. not copyrighted)</i>
- Free!
- Better than most commercial alternatives
- Available on all platforms <i>(Windows, OSX, Linux)</i>
- Not just for statistics, but also general purpose programming

---

## Why use R?

- Flexible
- Transparent
- Large user base
- Valued skill

---

## RStudio

- Integrated development environment (IDE) for the R language
- Specifically designed to improve coding experience in R
- Free version available

---

## Running R with RStudio

- The screen is split four ways: 
  - <b>Workspace:</b> (Top left) Where scripts are written & saved
  - <b>Console:</b> (Bottom left) Where commands are run
  - <b>Environment, History:</b> (Top right) Where objects are stored
  - <b>Files, Plots, Packages, and Help:</b> (Bottom right) View filesystem, figures, packages, help 

---

## Running R with RStudio

- Type directly into the console (best when you don't want to save the code) or type into a script (can be saved and rerun as needed)
- Run code by hitting `CTRL + ENTER` (`STRG + ⏎`) on Windows/Linux or `CMD + ENTER` (`CMD + ⏎`) on Mac
- Either run the line where you cursor is placed or highlight a larger block of code and run
- A <b>script</b> is a plain text file with R commands in it -- this will be where you save the code that you are writing
    - The file will end in the extension `.R`

---

## R as a calculator 

- R has many <b>arithmetic</b> operators 
  - `+`  Addition 
  - `-`  Subtraction 
  - `*`  Multiplication 
  - `/`  Division 
  - `^`  Exponentiation 
  - `%%` Modulus (finds remainder) 
  - `%/%` Integer division (leaves off remainder)

- R obeys the standard order of operations

---

## R as a calculator

Examples

```{r}
7 + 4
3^2
10 %% 7
```

---

## R is logical 

- R also has many <b>logical</b> operators 
  - `<`  Less than
  - `<=` Less than or equal to 
  - `>`  Greater than
  - `>=` Greater than or equal to  
  - `==` Exactly equal to 
  - `!=` Not equal to 
  - `!`  NOT
  - `|`  OR
  - `&`  AND

---

## R is logical 

Examples

```{r}
7 == 4
3 > 2
7 != 4
```

---

## Your turn {data-background-color=#BA43B0}

1. What is 21 multiplied by 342?

2. What is 15 to the fourth power?

3. Is 8 to the fifth power equal to the sum of 692 and 7500 multiplied by 4?

---

## Creating objects

- An <b>object</b> is the fundamental unit in R. All expressions can be saved as an object.
- To create an object from an expression we use the <b>assignment operator</b> (`<-`). The assignment operator assigns values on the right to objects on the left.

```{r}
a <- (12 + 180) * 3
a
```

- The object `a` is now the output of the expression `(12 + 180) * 3`. Check your <b>environment</b> (upper right panel)

---

## Assignment operator

- Do not use `=` for assignment in R. It's best practice to use `<-` instead.
- This is arbitrary, but a convention in R (the reasoning is that `<-` maintains backwards compatibility with S-Plus)
- But, it is good to follow conventions -- this makes your code more readable to others
<a href = "https://google.github.io/styleguide/Rguide.html" target = "_blank"> Google's R Style Guide  </a>
<a href = "http://adv-r.had.co.nz/Style.html" target = "_blank"> Advanced R: Style Guide </a>

---

## R Tip: Comment on your code {data-background-color=#66BA43}

<b>Use hashtags (`#`) to comment on your script.</b> Anything to the right of a `#` is ignored. Good scripts have comments before every major block of code. It's surprisingly hard to remember what you did when reviewing older code, and it's particularly important when other people are reading your code.  

```{r}
5 + 5  # this adds five and five 
# 10 + 10 this does not add ten and ten
```

---

## Expressions using objects

Objects can be combined into other, larger and more complex objects

```{r}
a <- 8 * 10
b <- 2 * 10
d <- a * b
d
# this is equivalent to: 
d <- 8 * 10 * 2 * 10
d
```

---

## Your turn {data-background-color=#BA43B0}

1. Create an object that is equal to your age. Create another object that is equal to the age of the person to your right. Find the difference between these objects. 

---

## Data structures: 1. Vectors

- R has <b>five</b> common data structures. We will start with the simplest: <b>vectors</b>.
- Vectors are one dimensional strings of numbers or characters. Vectors come in four types: numeric, integer, logical (TRUE or FALSE), and character. A vector is made using the combine function, `c()`.

---

## Data structures: 1. Vectors - Combining integers and numbers

```{r}
a <- c(3, 4, 5)
a
b <- c(3.24, 4.57, 5.03)
b
```

---

## Data structures: 1. Vectors - Combining characters

Characters in R need to be enclosed in quotation marks

```{r}
pets <- c("dog", "cat", "bird")
pets
```

---

## Data structures: 1. Vectors - Combining multiple objects

```{r}
# make objects 
a <- sqrt(4 * 7)
b <- 6 * 5
g <- 9 * 2
# combine
d <- c(a, b, g)
d
```

---

## Data structures: 1. Vectors - Regular sequences

- You can use a colon (<b>:</b>) to create a vector that includes all integers in between the numbers on either side of the colon

```{r}
x <- 1:10
x
```

- You can use `seq(from = , to = , by = )` to create a sequential vector with a particular minimum (`from`), maximum (`to`), and increment (`by`)

```{r}
x <- seq(from = 0, to = 20, by = 2)
x
```

---

## Your turn {data-background-color=#BA43B0}

1. Create a vector that includes all integers between 5 and 25. Name this vector `x`.
2. Create a vector that includes all even integers between 2 and 22. Name this vector `y`.
3. Create a single vector that <b>combines</b> object x and object y. Name this vector `z`.

---

## Data structures: 1. Vectors - Indexing by position

You can access any element in a vector by putting its <b>position</b> in square brackets `[ ]`

```{r}
# create a vector
height <- c(76, 72, 74, 74, 78)
height
height[1]  # extract the 1st element in the vector 
height[5]  # extract the 5th element
```

---

## Data structures: 1. Vectors - Indexing by position

You can also use positional vector indexing to return the same vector, but with certain elements missing, using the minus (`-`) sign

```{r}
height <- c(76, 72, 74, 74, 78)
height[-1]
```

---

## Data structures: 1. Vectors - Indexing by name

You can assign <b>names</b> to each element of the vector, and then extract an element by indexing based on the name

```{r}
# create a vector with named elements 
temp <- c(monday = 28.1, tuesday = 28.5, wednesday = 29.0, thursday = 30.1, 
          friday = 30.2)
temp
temp["wednesday"]
temp[3]
```

---

## Data structures: 1. Vectors - Logical indexing

You can extract elements in a vector that meet specific criteria based on a <b>logical expression</b>.

```{r}
y <- 5:50
y
y[y <= 10]   # extract all elements less than or equal to 10
y[y < 10 & y != 5]   # extract all elements less than 10 that are not equal to 5
```

---

## Your turn {data-background-color=#BA43B0}

1. What are the 9th and 12th positions of the vector `seq(from = 1, to = 27, by = 0.5)`? 

2. Create the vector `5:40` and name it `m`. Extract all elements of `m` that are greater than or equal to 22.

---

## Functions

- A <b>function</b> is a stored object that performs a task given some inputs (called <i>arguments</i>). R has many functions already available, but you can also write your own functions.
- Try using the tab key (`↹`) while entering arguments in any function to discover a useful feature of RStudio. (Try this now using the `seq()` function.)
- Functions are called in the format: `NameOfFunction(inputs)`   
- The output of a function can be saved to an object: `output <- NameOfFunction(inputs)`

---

## Functions

It's not necessary to explicitly name arguments, but it can be helpful for you and others reading your code

```{r}
seq(1, 10, 1)
seq(from = 1, to = 10, by = 1)
```

---

## Functions

- Use `sum()` to take the sum of all elements in a vector:

```{r}
sum(c(3, 4, 5))
```

- Use `mean()` to take the mean of all elements in a vector:

```{r}
mean(seq(5, 100, 5))
```

---

## Functions

Functions can act on an object

```{r}
x <- seq(5, 100, 5)
# use the vector x as the input to the mean function
mean(x)
```

---

## R Tip: The help system {data-background-color=#66BA43}

- Help files provide important information on what a function does, how it works, and they provide examples at the very bottom

```{r}
help(mean)
```

- You can also type `?` before a function name to view the help file 

```{r}
?mean   # same as help(mean) 
```

- Use `??` to search for functions, e.g., search for any function whose help files contain the word "robust"

```{r}
??robust
```

---

## Your turn {data-background-color=#BA43B0}

1. What is the median of 26, 24, 8, 17, and 42?   
<i>Hint:</i> functions are often named intuitively

2. What does the function `range()` do, and what is the example in the help file?

3. Is `mean(4, 5)` different than `mean(c(4, 5))`?

---

## Packages

- You can write your own functions in R
- Functions are also kept inside <b>packages</b>
- Some packages come pre-installed with R, and others must be downloaded

---

## Packages

- There are many, many R packages - currently 20,690 (when I first taught this course in 2016, there were "only" 7,742)
- You can view all packages here: <a href = "http://cran.r-project.org/web/packages/available_packages_by_name.html" target = "_blank"> List of R Packages</a>
- There are lots of packages commonly used by ecologists and evolutionary biologists (check out `ape`, `sf`, `vegan`, `lme4`, `dplyr`, ...)

---

## Installing packages

- Often you will need to install a package to access a certain library of functions

```{r, eval = FALSE}
# install a new package
install.packages("ggplot2") 
```

- Be sure to surround the package name in quotation marks (`""`)

---

## Loading packages 

- Installing a package <b>downloads</b> it to your computer. You need to download packages before loading them.
- Additionally, you have to <b>load</b> packages before you use them every time you restart R. This lets R know which packages to load and not waste memory by loading all possible functions.    

```{r}
# two ways to load packages
library(ggplot2)
require(ggplot2)
```

- Note: no quotation marks (`""`) are needed for arguments to the `library()` or `require()` functions

---

## R Tip: Loading packages {data-background-color=#66BA43}

- Good scripts have a series of `require()` or `library()` statements at the <b>top</b> of the script.

- FYI: <a href = "http://yihui.name/en/2014/07/library-vs-require/">Some say</a> that you should preferentially use `library()`. The logic behind this is because `require()` "tries" to laod a package and `library()` actually loads a package. If you use `require()` at the top of the screen and you don't have the package installed, you'll get a failure message later on when you use functions in the package. However, if you use `library()` at the top of the screen and you don't have the package installed, you'll get a failure message right away.

---

## The R user community

<a href = "http://stackoverflow.com/questions/tagged/r" target = "_blank">Stack Overflow</a> 

<a href = "http://www.r-bloggers.com/" target = "_blank">R-Bloggers</a> 

<a href = "http://www.r-project.org/mail.html" target = "_blank">R Mailing Lists</a>

Note that large language model chatbots (like ChatGPT) were trained using the above sources.

---

## Practice {data-background-color=#4387BA}

Worksheets created by Mike McCann and hosted on his Rpubs site

<a href = "https://rpubs.com/mccannecology/53351" target = "_blank">Worksheet</a>

<a href = "https://rpubs.com/mccannecology/53358" target = "_blank">Answers</a>

---

## <b>Part 2:</b> Probability & distributions

<a href = "#/2">Back to the directory</a>

---

## Review {data-background-color=#B98A42}

1. What is the sum of 1 through 10, multiplied by two? 

2. What are the 12th and 45th positions of the vector `seq(1, 43, 0.25)`?

3. Find all of the elements of the vector `seq(1, 10, 0.1)` that are less than 2. What is the median value of these elements?

---

## Distributions

It is often useful to generate a sample from a particular statistical distribution. To generate a sample of 1000 elements from a standard normal distribution (mean 0 and standard deviation 1) we can use the `rnorm()` function.

```{r, echo = FALSE}
par(mfrow = c(1, 1), mar = c(2.5, 2.5, 0, 0), mgp = c(1.5, 0.6, 0), cex.main = 1.1, cex.axis = 1.1, cex.lab = 1.1)
```

```{r, fig.height = 2, fig.width = 3}
# create vector of samples from standard normal dist
norm <- rnorm(n = 1000, mean = 0, sd = 1)
# view the first six elements of the vector
head(norm)
# plot the vector of samples as a histogram
hist(norm, col = "palevioletred", main = "", xlab = "", ylab = "Frequency")
```

---

## Your turn {data-background-color=#BA43B0}

1. Draw 100 random numbers from a normal distribution with a mean of 3 and a standard deviation of 2, assign it to an object `a`.
2. Find the mean of your sample. How close was it to the true mean (the mean that you set in `rnorm()`)?
3. What is the 13th element in your vector `a`?

---

## Generating random samples from other distributions

- R has many available distributions, including all those commonly used in biological analyses
- Depending on the distribution, each function has its own set of parameter arguments
- For example, the `rpois()` function is the random sampler for the Poisson distribution, and it has only the parameter <i>lambda</i> ($\lambda$).

---

## Your turn {data-background-color=#BA43B0}

1. Draw 100 random samples from a Poisson distribution with `lambda = 3`, assign it to an object `w`.
2. Draw 1000 random samples from a Poisson distribution with `lambda = 3`, assign it to an object `y`.
3. Calculate the means of both vectors. What is the difference in means?

---

## Other properties of distributions 

- For each distribution, there are <u>four functions</u> that generate fundamental quantities
  - <b>`rnorm()`</b> random sample
  - <b>`dnorm()`</b> probability density (or densities) function
  - <b>`pnorm()`</b> cumulative distribution function
  - <b>`qnorm()`</b> quantile function

```{r, echo = FALSE, fig.height = 3, fig.width = 6}
library(scales)
samp.size <- 1000
sn.quant <- seq(-4, 4, 0.01)
sn.yvals <- dnorm(x = sn.quant)
sn.samp20 <- rnorm(n = 20)
sn.xvals2 <- c(seq(-4, 2, 0.01), 2)
sn.yvals2 <- dnorm(x = sn.xvals2)
sn.yvals2[length(sn.yvals2)] <- 0
sn.d2 <- dnorm(x = 2)
sn.quant2 <- qnorm(p = 0.977)
plot(x = sn.quant, y = sn.yvals, type = "n", xlim = c(-4, 4), ylim = c(0, 0.4), xlab = "x", ylab = "dnorm(x)", bty = "n")
lines(x = sn.quant, y = sn.yvals, type = "l", lwd = 2, col = "#000000")
polygon(x = sn.xvals2, y = sn.yvals2, col = alpha("#E7AD52", 0.5), border = NA)
lines(x = c(2, 2), y = c(0, sn.d2), lwd = 2, col = "#51A1E8")
points(x = sn.samp20, y = rnorm(n = 20, mean = 0, sd = 0.005), cex = 1, pch = 19, col = "#E851CF")
points(x = sn.quant2, y = 0, cex = 1, pch = 19, col = "#74E851")
text(x = -2.3, y = 0.37, labels = "Y ~ Normal(μ = 0, σ = 1)", col = "#000000", cex = 1.2)
text(x = 1.8, y = 0.3, labels = "pnorm(q = 2)\n= 0.977", col = "#E7AD52", cex = 0.9)
text(x = -0.5, y = 0.03, labels = "rnorm(n = 20)", col = "#E851CF", cex = 0.9)
text(x = sn.quant2 + 0.5, y = 0.1, labels = "dnorm(x = 2)\n= 0.054", col = "#51A1E8", cex = 0.9)
text(x = sn.quant2 + 1.1, y = 0.04, labels = "qnorm(p = 0.977)\n= 2", col = "#74E851", cex = 0.9)
arrows(x0 = 1.5, y0 = 0.3, x1 = 0, y1 = 0.25, col = "#E7AD52", lwd = 1, length = 0.1)
arrows(x0 = 2.2, y0 = 0.08, x1 = 2, y1 = sn.d2, col = "#51A1E8", lwd = 1, length = 0.1)
arrows(x0 = 2.8, y0 = 0.04, x1 = 2, y1 = 0, col = "#74E851", lwd = 1, length = 0.1)
```

<small>Figure adapted from <a href = "http://user.mendelu.cz/drapela/Forest_Biometry/Lecture%20notes/R%20-%20tutorials%20and%20commands/R%20Probability%20Functions.pdf" target = _blank">this</a> website</small>

---

## Univariate plots - Barplots

Barplots are a basic type of univariate plot. The R function to create one is `barplot()`

```{r, fig.height = 2, fig.width = 5}
head(rivers)
barplot(height = rivers[1:10], col = "paleturquoise", 
        xlab = "Rivers in North America", ylab = "Length (in miles)")
```

---

##  Univariate plots - Histograms

- Histograms are also a common univariate plot. Histograms place data into "bins", and count the number (frequency) of data falling into each bin. 
- Bins are usually plotted as bars, with the x range on the x axis, and frequency on the y axis.

---

##  Univariate plots - Histograms

Histograms are an effective way of visualizing distributions

```{r, fig.height = 3, fig.width = 5}
# generate and visualize 1000 random samples from a standard normal distribution
sample <- rnorm(1000)
hist(sample, col = "palevioletred", main = "", xlab = "", ylab = "Frequency")
```

<small>For those who care about color selection: <a href = "http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" target = "_blank">R Colors</a></small>

---

## Your turn {data-background-color=#BA43B0}

1. Draw 10 random variates (values) from a normal distribution and plot a histogram of the sample. Repeat for 100, then 1000 random variates. What do you notice about the histograms?

2. Explore at least one other distribution; look up `?distributions`. Take a random sample of the new distribution and plot the sample.

---

## Sampling

In R, it's very easy to take a random sample of elements in any vector using the `sample()` function

```{r}
x <- 1:50
sample(x, size = 20)  # sample without replacement
sample(x, size = 20, replace = TRUE)  # sample with replacement
```

---

## Your turn {data-background-color=#BA43B0}

1. Sample 9 elements from a vector of integers between 125 and 325 without replacement.
2. Sample 5 letters (using the pre-installed vector `letters`) with replacement.
3. Sample 0 or 1 twelve times, with and without replacement. What happens?

---

## Bivariate plots - Scatterplots

Scatterplots are useful for showing the relationship between two variables 
 
```{r, fig.height = 3, fig.width = 3}
# random sample from a normal dist
sample1 <- rnorm(n = 40, mean = 4, sd = 2)
# random sample from a different normal dist
sample2 <- rnorm(n = 40, mean = 2, sd = 1)
plot(x = sample1, y = sample2, pch = 20, xlab = "Sample 1", ylab = "Sample 2")
```

---

## Bivariate plots - Scatterplots

You can add straight lines to a plot using the `abline()` function. Argument `a` specifies the intercept and `b` specifies the slope

```{r, fig.height = 3, fig.width = 3}
plot(sample1, sample2, pch = 20, xlab = "Sample 1", ylab = "Sample 2")
abline(a = -0.1, b = 1, lwd = 2, col = "royalblue4")
```

---

## Bivariate plots - Scatterplots

- Lines can also be model fits 

- `lm()` fits a linear relationship between <b>x</b> and <b>y</b>.

```{r, fig.height = 3, fig.width = 3}
plot(sample1, sample2, pch = 20, xlab = "Sample 1", ylab = "Sample 2")
abline(lm(sample2 ~ sample1), lwd = 2, col = "royalblue")
```

---

## Lots of useful links for plotting 

<a href = "http://rpubs.com/SusanEJohnston/7953" target = "_blank">R Base Graphics: An Idiot's Guide</a>

<a href = "https://leemendelowitz.github.io/blog/r-base-graphics-plotting.html" target = "_blank">R Base Graphics Plotting</a>

<a href = "http://www.statmethods.net/graphs/" target = "_blank">Quick-R: Basic Graphs</a>

<a href = "http://www.harding.edu/fmccown/r/" target = "_blank">Producing Simple Graphs with R</a>

<a href = "http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" target = "_blank">R Colors</a>

More on plotting later (we will make plots that are much more visually appealing!)

---

## Practice {data-background-color=#4387BA}

<a href = "https://rpubs.com/mccannecology/53352" target = "_blank">Worksheet</a>

<a href = "https://rpubs.com/mccannecology/53359" target = "_blank">Answers</a>

---

## <b>Part 3:</b> Data manipulation

<a href = "#/2">Back to the directory</a>

---

## Download the file for this section

<a href = "https://www.dropbox.com/s/qk11hhsipddk3fk/seedlings.csv?dl=0" target = "_blank">seedlings.csv</a>

---

## Data structures: 2. Data frames

Most data you'll work with probably isn't in vector form. More likely, it includes multiple rows and columns. Thus, a <b>data frame</b> is a very important data type in R and what you'll be working with much of the time. 

```{r}
# pre-loaded dataset in R - measurements of black cherry trees
head(trees)
```

---

## Data structures: 2. Data frames

Data frames are usually read in from a file, but R comes with many practice datasets. 
We will use the `iris` dataset, <a href = "http://en.wikipedia.org/wiki/Iris_flower_data_set" target = "_blank">famously used by R.A. Fisher in 1936</a>

<a href="https://commons.wikimedia.org/wiki/File:Iris_versicolor_3.jpg#/media/File:Iris_versicolor_3.jpg" title = "Iris versicolor"><img src = "https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Iris_versicolor_3.jpg/800px-Iris_versicolor_3.jpg" height = "175" width = "275"></a>

```{r}
head(iris)
```

---

## Data structures: 2. Data frames - Useful functions

- `head()` - see first six rows
- `tail()` - see last six rows
- `dim()` - dimensions (# rows, # columns)
- `nrow()` - number of rows
- `ncol()` - number of columns
- `str()` - structure of any object <i>(very useful!)</i>
- `class()` - class of any object
- `rownames()` - row names 
- `colnames()` - column names

---

## Your turn {data-background-color=#BA43B0}

1. How many rows does the `iris` data frame have?
2. How many columns? What are the column names?
3. Using the `str()` function, how many species are in the data?
4. What are the classes of each of the columns?

---

## Data structures: 2. Data frames - Syntax and subsetting

- R has many powerful subset operators that will allow you to easily perform complex operations on any kind of dataset (much easier than with Excel!)
- Think of data frames as a series of vectors grouped together into a table

```{r}
head(iris)
```

---

## Data structures: 2. Data frames - Index by position

Index individual elements of a data frame with `df[row#, column#]`

```{r}
iris[1, 1]  # first row, first column
iris[3, 3]  # third row, third column
```

---

## Data structures: 2. Data frames - Index by position

Index entire rows or columns by leaving one of the positions blank, i.e. `df[, column#]` or `df[row#, ]`

```{r}
iris[2, ]  # subset the entire second row 
iris[, 2]  # subset the entire second column 
```

---

## Data structures: 2. Data frames - Index by position

- Data frames can be indexed for both rows and columns
- To get the 5th, 7th, and 9th rows for the first two columns in the `iris` data frame:

```{r}
iris[c(5, 7, 9), 1:2]
```

---

## Data structures: 2. Data frames - Index by name

- Columns can also be called by name using brackets

```{r, eval = FALSE}
iris[, "Sepal.Length"]
```

- Or you can call a column by name using dollar sign (`$`) notation

```{r, eval = FALSE}
iris$Sepal.Length
```

---

## Your turn {data-background-color=#BA43B0}

1. What is the 9th entry of the `Sepal.Width` column? Save it as object `x`.
2. Subset the 17th row of the data frame `iris`.
3. Return an object with the 1st, 4th and 7th rows of the `iris` dataframe.
4. Use the `seq()` function to subset all odd rows in the `iris` dataset.
5. What happens when you use negative numbers to index the `iris` dataframe? <b>Hint:</b> Use the function `dim()` on the original and final objects.

---

## Data structures: 2. Data frames - Logical indexing

- It can be extremely helpful to subset your data using logic rather than by position or name  

```{r, fig.height = 3, fig.width = 5}
# make a histogram of petal width frequency
hist(iris$Petal.Width, col = "darkseagreen1", xlab = "Petal width (in cm)", ylab = "Frequency", main = NULL)
```

- Continued on next slide

---

## Data structures: 2. Data frames - Logical indexing

```{r}
# which petal widths are greater than 1 cm?
large.petals.logi <- iris$Petal.Width > 1  
head(large.petals.logi)
# subset of iris only including individuals where petal width is greater than 1 cm
iris.p1.sub <- iris[large.petals.logi, ]  
head(iris.p1.sub)
```

This is the same as:

```{r, eval = FALSE}
iris[iris$Petal.Width > 1, ]
```

---

## Your turn {data-background-color=#BA43B0}

1. Why is `iris[iris > 3, ]` a nonsensical command? 
2. Why is `iris[iris$Sepal.Length > 3]` a nonsensical command?
3. Create a histogram of petal lengths for the entire data.
4. Subset the data for petal lengths greater than two centimeters.
5. Create a histogram of your new data.

---

## Data structures: 2. Data frames - Logical indexing

For all types of data, if we want to subset a specific value/character/factor we use the logical operator "`==`"

```{r}
# subset of observations where petal length is equal to 4 cm
iris.p4.sub <- iris[iris$Petal.Length == 4.0,]
head(iris.p4.sub)
```

---

## Data structures: 2. Data frames - Logical indexing

- Subset only records from the species <i>Iris versicolor</i>
- Note that quotation marks are needed when dealing with characters or factors

```{r}
iris.vers.sub <- iris[iris$Species == "versicolor", ]
head(iris.vers.sub)
```

---

## Data structures: 2. Data frames - Logical indexing

- It's also possible to combine logical statments:
  - Use <b>`&`</b> (AND) if you want both statements to be true.  
  - Use <b>`|`</b> (OR) if you want either statement to be true.

```{r}
# subset of observations of Iris versicolor where petal length is greater than 4 cm
iris.vers4.sub <- iris[iris$Petal.Length > 4 & iris$Species == "versicolor", ]
head(iris.vers4.sub)
```

---

## Your turn {data-background-color=#BA43B0}

Explain in words each of the following indexing statements:

1. `iris[1:4, ]`
2. `iris[c(1:15), c(1, 3)]`
3. `iris[iris$Species == "setosa", "Petal.Width"]`
4. What happens when you add a `!` before a logical statement? <b>Hint:</b> Compare `iris[iris$Species == "setosa", ]` and `iris[!(iris$Species == "setosa"), ]`.

---

## Data structures: 2. Data frames - Building from scratch

Use the <b>`data.frame()`</b> function

```{r}
num.df <- data.frame(x = 1:5, y = 6:2)
num.df
```

---

## Data structures: 2. Data frames - Adding columns

- You can add columns using the `data.frame()` function

```{r}
# adding new column z to previous df
num.df <- data.frame(num.df, z = 41:45)
num.df
```

- Or, you can use the assignment operator `<-` with the `$` notation

```{r}
num.df$z <- 41:45
num.df
```

---

## Data structures: 2. Data frames - Removing columns

- Use the minus (`-`) sign and the index of the position you want to remove

```{r}
num.sub <- num.df[, -3]
num.sub
```

- Or, assign `NULL` to the column (using the assignment operator `<-` and the `$` notation)

```{r}
num.df$z <- NULL
num.df
```

---

## Data structures: 3. Matrices

- Similar to data frames, matrices are two-dimensional. However, they can consist only of numbers (not characters or factors).
- Why do you need them? Some functions (e.g., matrix algebra) require a matrix as an input

```{r error = TRUE}
num.mat <- matrix(1:9, ncol = 3, nrow = 3)
num.mat
num.df <- as.data.frame(num.mat)  # convert matrix to df

diag(num.df)  # function fails with df
diag(num.mat)  # works with matrix
```

---

## Data structures: 3. Matrices

Indexing is the same as with data frames

```{r}
num.mat <- matrix(1:9, ncol = 3, nrow = 3)
num.mat
num.mat[2, 2]
num.mat[2, ]
```

---

## Importing your own data

- R is not a spreadsheet program, so it's not great for direct data entry. It's best to start with spreadsheets for data entry and storage, and to import spreadsheets into R for data analysis and visualization.
- CSV (comma separated values) files are often the preferred format to import into R. 
- Before we do that, we will need to consider <b>working directories</b>.

---

## Working directory

- Find out what your current working directory is

```{r}
getwd()
```

- This is the folder on your computer where R will look to open or write files

---

## Working directory

- Set your working directory 

```{r, eval = FALSE}
setwd("/home/nlkinlock/Documents/")
```

---

## Importing your own data

- Load the downloaded seedling data to your environment

```{r, eval = FALSE}
seedling.df <- read.csv("/home/nlkinlock/Documents/seedlings.csv", fileEncoding = "UTF-8")
head(seedling.df)
```

---

## R Tip: Variable names {data-background-color=#66BA43}

- One of the largest sources of frustration with R can be importing data. Variable names, e.g., column names in a spreadsheet, often cause problems. 
  - <b>Do not include spaces in variable names</b>  
  - <b>Abbreviate when appropriate</b>  

```{r, eval = FALSE}
# BAD - this won't work
Average Height
# BETTER - these will work, but will be slow to type repeatedly
Average.Height, Average_Height, average.height, average_height, averageHeight
# GOOD!
avg.height, avg_height, avgHeight 
```

---

## Your turn {data-background-color=#BA43B0}

1. Import the data frame <a href = "https://www.dropbox.com/s/qk11hhsipddk3fk/seedlings.csv?dl=0" target = "_blank">seedlings.csv</a> and load it to your environment. Store it as an object, `seedlings.df`.
2. What is the mean height for all seedlings? What about the mean height for all seedlings except <i>Rhus typhina</i>?
3. What is the difference in the mean height for <i>Rosa multiflora</i> seedlings and <i>Rubus occidentalis</i> seedlings?

---

## Exporting data frames 

- After you've made changes (subsetting, etc.), you may want to export the altered data frame.

```{r, eval = FALSE}
# write the file 
write.csv(iris, file = "iris_cleaned.csv", row.names = FALSE, fileEncoding = "UTF-8")
```

---

## Helpful link

<a href = "http://adv-r.had.co.nz/Data-structures.html" target = "_blank">Data structures</a>

---

## Practice {data-background-color=#4387BA}

<a href = "https://rpubs.com/mccannecology/53354" target = "_blank">Worksheet</a>

<a href = "https://rpubs.com/mccannecology/53360" target = "_blank">Answers</a>

---

## <b>Part 4:</b> Looping and vectorization

<a href = "#/2">Back to the directory</a>

---

## For loops

- Loops are an important programming tool. The first loop we will learn is a <b>for loop</b>. 
- For loops run for a certain number of steps (iterations) that you define, during which any statements in the loop are executed.
- The basic syntax is:

`for (i in 1:number_of_iterations) {`

`execute these statements`

`}`


---

## For loops - Why use a for loop?

1. We have a repeated process with identical steps, but different values
2. To avoid laborious typing into R

---

## For loops - Our first loop

`for (i in 1:5) {`

- `i` starts at 1. R will execute some statements; 
- `i` is increased to `i = 2` and statements are executed again; 
- `i` is increased to `i = 3` and statements are executed again; 
- and so on, until `i = 5`, at which point the loop executes the set of statements for the last time

`}`

---

## For loops - Our first loop

```{r}
for (i in 1:5) {
    print(i)
}
```

---

## For loops - Syntax 

- <b>Be sure you can distinguish between:</b>
    - curly braces `{ }` 
    - parentheses `( )`  
    - square brackets `[ ]`

---

## For loops - Syntax 

Square brackets `[ ]` are used to access <i>elements</i> of vectors, matrices, and data frames. The number of dimensions is very important.

```{r}
# initialize vector
test.vec <- 1:10
test.vec[6]   # vectors have one dimension
test.vec[c(2, 6, 9)]
# initialize matrix
test.mat <- matrix(data = seq(0.1, 10, 0.1), nrow = 10, ncol = 10)
test.mat[6, 6]  # matrices have two dimensions
test.mat[6, ]
```

---

## For loops - Syntax 

Parentheses `( )` are used to specify arguments to <i>functions</i>

```{r}
x <- 1:10
sum(x)
mean(x)
```

---

## For loops - Syntax 

Finally, curly braces `{ }` are used to enclose all of the statements to be executed in a loop

```{r}
for (i in 1:3) {
    print(i)
}
```

---

## For loops - Using a for loop

You can perform operations on the <b>loop variable</b>, `i`

```{r}
for (i in 1:4) {
    print(i^2)
}
```

---

## For loops - Using a for loop

- <b>Assignments</b> can occur in a loop

```{r}
x <- 2
for (i in 1:4) {
    x <- x^2
    print(x)
}
```

- `i` is not directly called in this loop, unlike in the previous examples

- The operation `x <- x^2` is done four times -- `x` changes with each iteration because of its re-assignment in the loop

---

## Your turn {data-background-color=#BA43B0}

1. Create a for loop that prints integers 1 to 100.
2. Create a for loop that prints integers 100 to 1.
3. Create a for loop that adds 1 to integers 1 through 5.
4. Create a for loop that divides all even integers from 0 to 20 by 10 (consider using `seq()`).

---

## For loops - Vectors and for loops

In the above examples, we used the loop variable `i` directly in mathematical operations. It is more common to loop over elements of a vector to accomplish some particular task.

```{r}
name.vec <- c("Larry", "Curly", "Moe")
for (i in 1:length(name.vec)) {
    print(paste("Hi,", name.vec[i], sep = " "))
}
```

---

## For loops - Vectors and for loops

- What did that really do? Consider the loop in pieces, here just for `i = 1`

```{r}
name.vec[1]  # the 1st position in name.vec
# combine text and indexed vector
paste("Hi,", name.vec[1], sep = " ") 
```

---

## For loops - Vectors and for loops

- Loops exist in their own enclosed environment (in contrast to the <b>global environment</b>, or the main workspace)
- You can use the `print()` function to view the output of each iteration in your console

```{r}
name.vec <- c("Larry", "Curly", "Moe")
for (i in 1:length(name.vec)) {
    print(paste("Hi,", name.vec[i], sep = " "))
}
```

Without `print()` or an assignment `<-` no results are returned

```{r}
for (i in 1:length(name.vec)) {
    paste("Hi,", name.vec[i], sep = " ")
}
```

---

## Your turn {data-background-color=#BA43B0}

1. Create a vector of the days of the week and generate a message that says "Today is x" using a loop. 
2. Explain why the following code is wrong:  
```{r, eval = FALSE}
for (x in 1:10) {
    print(sum(i))
}
```

---

## Data structures: 4. Lists 

- <b>Lists</b> are another of the five basic data structures in R. Lists, like vectors, are one dimensional.
- First, let's compare with vectors. The elements of a vector must all be the same type. In this example, `1` and `2` are converted to characters because `"blue"` is included.

```{r}
x <- c(1, 2, "blue")
x
typeof(x)
```

---

## Data structures: 4. Lists

- In contrast, the elements of a list can be any type (numeric, integer, logical, character), or other lists.

```{r}
test.lst <- list(numeric = seq(0, 0.25, 0.01), integer = 10:20, logical = c(TRUE, FALSE, FALSE), character = c("open", "closed", "closed", "open"))
test.lst
```

- It may seem multidimensional, but it does behave as a one dimensional data structure.

---

## Data structures: 4. Lists - Constructing lists

You can construct a list with the `list()` function (compare with the combine function, `c()`, for vectors) 

```{r}
x <- c(1, 2, 3, 4, 5)
y <- c(3, 6, 8, 10)
test.vec <- c(x, y)  # create a vector
str(test.vec)
test.lst <- list(x, y)  # create a list
str(test.lst)
```

---

## Data structures: 4. Lists - List indexing

- Using the single square bracket index operator `[]` will return <u>a list</u>
- Using a double square bracket index operator `[[]]` will return <u>contents within a list</u>
- The main difference is in the <b>class</b> of the output

```{r}
test.lst <- list(1:4, c(3.25, 6.75, 8.175, 4.5), 
                 c("apples", "bananas", "oranges", "pears"))
str(test.lst[2])  # returns a list
str(test.lst[[2]])  # returns numbers from list
```

---

## Data structures: 4. Lists - List indexing

```{r error = TRUE}
test.lst[1] * test.lst[2]  # can't do arithmetic on lists
test.lst[[1]] * test.lst[[2]]  # can do arithmetic on numbers
```

---

## Data structures: 4. Lists - List indexing

In order to reference a <b>single list element</b> directly, we have to use both the double square bracket `[[ ]]` operator and the single bracket `[]` operator

```{r}
test.lst[[2]]  # 2nd element of list 
test.lst[[2]][2]  # 2nd element of 2nd element of list 
```

---

## How do we save loop outputs?

- Instead of printing to the screen, we usually want to create a new object with the outputs on the loop.
- To do this, you need to create an empty vector or list before the loop

```{r}
# create an empty vector
output.vec <- c()
x <- rnorm(n = 10, mean = 1, sd = 0.5)
for (i in 1:length(x)) {
    output.vec[i] <- x[i] * 10
}
output.vec
```

---

## Your turn {data-background-color=#BA43B0}

First, create a vector, `y`, with 10 random samples from a standard normal distribution `(mean = 0, sd = 1)`.

1. Compute `y[i] * 2` for 10 iterations (the length of vector y) using a for loop with index `i`. Place the output in a <b>vector</b>.  
2. Compute `y[i] * 2` for 10 iterations using a for loop. Place the output in a <b>list</b>.
3. Find the the 4th element in the output vector from question 1 and the output list from question 2.

---

## Flow statements - if statements

```{r}
if (3 > 2) {
    print("This makes sense")
}
if (3 < 2) {
    print("The world is not how I envisioned")
}
```

---

## Flow statements - if statements

- Often, we want for loops to be able to do different things under different conditions
- Let's use an <b>if</b> statement:

```{r}
x <- 1:5
for (i in 1:length(x)) {
    if (x[i] > 3) {
        print(paste(x[i],"is greater than 3"))
    }
    if (x[i] <= 3) {
        print(paste(x[i],"is less than or equal to 3"))
    }
}
```

---

## Flow statements - else statements

- <b>If</b> statements are often paired with <b>else</b> statements, used when we want to run specific code in a given case (`if`) and the same code for every other possible case (`else`)

```{r}
x <- rpois(n = 20, lambda = 1)
output.vec <- c()
for (i in 1:length(x)) {
    if (x[i] == 0) {
        # execute the code in this if statement in one special case
        output.vec[i] <- -100
    } else {
        # for every other case, execute this code
        output.vec[i] <- x[i]^2
    }
}
output.vec
```

---

## Flow statements - break statements

- Sometimes we want the loop to end if certain logical criteria are met
- We can end a loop based on an <b>if</b> and <b>break</b> statement

```{r}
x <- 1:10
for (i in 1:length(x)) {
    if (x[i] > 3){
        break
    }
    if (x[i] <= 3) {
        print(paste(x[i],"is less than or equal to 3"))
    }
}
```

---

## Flow statements - next statements

- Sometimes we don't want to break the loop, just skip an element that we know will cause an error
- We can skip the current iteration of the loop using using an <b>if</b> and <b>next</b> statement

```{r}
for (i in 1:length(x)) {
    if (x[i] == 4) {
        next
    }
    if (x[i] > 3) {
        print(paste(x[i],"is greater than 3"))
    }
    if (x[i] <= 3) {
        print(paste(x[i],"is less than or equal to 3"))
    }
}
```

---

## Your turn {data-background-color=#BA43B0}

First, create a vector, `x`, with all integers between 1 and 100.

1. Create a for loop that computes `x[i] * 2` for 100 iterations (the length of vector `x`). Place the output in a vector. However, calculate `x[i] * 3` when `x[i] == 32`. 
2. Create a for loop that computes `x[i] * 2` for 100 iterations. Place the output in a list. However, break the loop after 51 iterations.
3. Create a for loop that computes `x[i] * 2` for 100 iterations. Place the output in a vector. However, skip `x == 71`.

---

## Alternatives to for loops: The apply family

- The <i>apply</i> family of functions allows you to process whole rows, columns, or list elements, and they can replace for loops
- `apply(X, MARGIN, FUN)`
- `X` is your matrix or data frame
- `MARGIN = 1` apply function to rows of matrix; `MARGIN = 2` apply to columns of matrix; `MARGIN = c(1,2)` apply to rows and columns of matrix
- `apply(M, 2, MyFunction)` = apply `MyFunction` to the columns of `M`

---

## The apply family

Use `apply()` to take the median of the columns of matrix `M` (using the `median()` function)

```{r}
M <- matrix(rnorm(9), ncol = 3, nrow = 3)
M
apply(M, 2, median)
```

---

## The apply family

The same analysis, but using a for loop

```{r}
med.M <- c()
for (i in 1:ncol(M)) {
    med.M[i] <- median(M[, i])
}
med.M
```

---

## The apply family

- There are other versions of `apply()` for other data types:
  - `lapply()`: apply function to list or vector, return list
  - `sapply()`: apply function to list or vector, return list or vector if possible
  - `vapply()`: similar to `sapply()`, but you have to specify output type
  - `tapply()`: apply function split by factor
  - `mapply()`: apply function to multiple lists or vectors

- Read more <a href = "https://ademos.people.uic.edu/Chapter4.html" target = "_blank">here</a> or <a href = "http://www.r-bloggers.com/using-apply-sapply-lapply-in-r/" target = "_blank">here</a>

---

## The apply family

- You can use `lapply()` to apply a function to elements of a list

```{r, error = TRUE}
test.lst <- list(1:3, c(1.4, 4.6, 4.2, 2.1), rnorm(4))
sum(test.lst)  # returns an error 
lapply(test.lst, sum)  # applies function to each element in the list
```

---

## Useful links

<a href = "http://adv-r.had.co.nz/Subsetting.html" target = "_blank">Subsetting tutorial</a>

<a href = "https://adv-r.hadley.nz/control-flow.html" target = "_blank">Control flow</a>

<a href = "https://bookdown.org/content/d1e53ac9-28ce-472f-bc2c-f499f18264a3/loops.html" target = "_blank">For loops</a>

---

## Practice {data-background-color=#4387BA}

<a href = "https://rpubs.com/mccannecology/53355" target = "_blank">Worksheet</a>

<a href = "https://rpubs.com/mccannecology/53361" target = "_blank">Answers</a>

---

## <b>Part 5:</b> Functions

<a href = "#/2"> Back to the directory </a>

---

## Functions in R

- Functions contain sets of instructions that we want to carry out repeatedly
- We have already seen many of the basic functions that come pre-installed with R

```{r, eval = FALSE}
sum(seq(1, 100, 1))
abs(-100 + 50)
dim(iris)
str(iris)
colnames(iris)
```

---

## Functions in R - Packages 

- We have also seen functions that are loaded from packages

```{r, eval = FALSE}
# this would not run - tree is not loaded 
tree(formula = Species ~ . -Species, data = iris) 
install.packages("tree")  # install package 
library(tree)  # load package 
# now it would work 
tree(formula = Species ~ . -Species, data = iris)
```

---

## Making your own functions

It is also possible to <i>define your own functions</i>. This is especially important if you are going to write the same lines of code over and over again. R functions are objects just like anything else.

`FunctionName <- function(<arguments>) { <body> }`

```{r}
# define function
SumTwoValues <- function(x, y) {
    return(x + y)
}
# call function
SumTwoValues(x = 1, y = 3) 
```

---

## Functions and the environment 

- Variables defined inside functions exist in a different <b>environment</b> than the global environment, i.e. they don't exist outside of the function
- However, if a variable is not defined inside a function, the function will look one level above
- If you run the function below, you'll see that `y` does not pop up in your environment panel

```{r}
x <- 2  # x variable defined outside the function
HiddenY <- function() {
    y <- 1  # y variable defined inside the function 
    return(c(x, y))
}
# function looks for x one level above (in global environment)
HiddenY()
```

---

## Function basics

Unless you explicitly return the output, e.g., by using the `return()` function, you won't be able to access it

```{r}
NoReturn <- function(a, b) {
  # x, y, z exist only in function environment
    x <- a + b 
    y <- (a + b)^2
    z <- a/b
}
NoReturn(1, 2)  # doesn't return anything
YesReturn <- function(a, b) {
    x <- a + b 
    y <- (a + b)^2
    z <- a/b
    return(c(x, y, z))
}
YesReturn(1, 2)  # returns x, y, and z
```

---

## Your turn {data-background-color=#BA43B0}

1. Create a function that takes in two arguments, `x` and `y`, and computes `x * 2 * y`.
2. Create a function that takes in three arguments, and makes a vector from the result.
3. Create a function that counts the number of matching elements in two separate vectors. <b>Hint:</b> use `%in%` to create a logical statement.

---

## Function basics

Arguments can be passed to a function as a vector or a list

```{r}
params <- c(5, 25)
MultAlphaBeta <- function(p) {
    alpha <- p[1]
    beta <- p[2]
    return(alpha * beta)
}
MultAlphaBeta(params)
```

---

## Function basics

You can set pre-defined values for function arguments

```{r}
subtract <- function(a = 5, b = 2) {
    return(a - b)
}

subtract()
subtract(3, 6)
```

---

## Your turn {data-background-color=#BA43B0}

1. Write a function that takes a vector as an argument and multiplies the sum of the vector by 10. Return a logical statement based on whether the sum is under 1000.
2. Write a function that calculates the mean of every column in a data frame. Code the function so that it does not evaluate the column mean if the column elements are not numbers, using the logical statement <b>`class(x) != "numeric"`</b>. Try your function on the `iris` dataset.

---

## Your turn {data-background-color=#BA43B0}

```{r}
ColumnMeans <- function(x) {
  output <- c()
  for (i in 1:ncol(x)) {
    if(class(x[, i]) != "numeric") {
      output[i] <- NA
    }
    if(class(x[, i]) == "numeric") {
      output[i] <- mean(x[, i])
    }
  }
  names(output) <- colnames(x)
  return(output)
}
ColumnMeans(iris)
```

---

## Helpful links

<a href = "https://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/functions.html" target = "_blank">Tutorial on using functions in R</a>

<a href = "http://adv-r.had.co.nz/Functions.html" target = "_blank">Advanced R - Functions</a>

---

## Practice {data-background-color=#4387BA}

<a href = "https://rpubs.com/mccannecology/53356" target = "_blank">Worksheet</a>

<a href = "https://rpubs.com/mccannecology/53362" target = "_blank">Answers</a>

---

## <b>Part 6:</b> Data visualization using `ggplot2`

<a href = "#/2"> Back to the directory </a>

---

## Review {data-background-color=#B98A42}

`ggplot2` is not a base package, so we need to install it.

1. How would you install the package `ggplot2`?
2. What is the next step before you can use a function from `ggplot2`? 

---

## Install and load `ggplot2`

```{r, eval = FALSE}
install.packages("ggplot2")
library(ggplot2)
```

---

## Why `ggplot2`?

- Works very well with data frames
- Easier to create visually appealing figures 
- Useful for exploring trends in your data

---

## Why gg?

- `gg` stands for "grammar of graphics"

- There is a set of terms that defines the basic components of (every) plot

- Using this set of terms, you can produce figures using coherent, consistent syntax (very similar code for very different figures)
  - However, this syntax does vary quite a bit from typical R syntax!
  - If you are a little confused by the syntax at first, that probably just means that you are getting more comfortable with the R language

---

## The grammar

- A basic `ggplot2` plot consists of:
  - `data`: Must be a <b>data frame</b>
  - `aes`(thetics): How your data are represented visually <i>(x, y, color, size, shape, etc.)</i>
  - `geom`(etry): What type of geometric objects you want to display <i>(points, lines, polygons, etc.)</i>

---

## A basic plot 

```{r, fig.height = 3, fig.width = 6}
library(ggplot2)
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width)) + geom_point()
```

---

## Plots can be assembled in pieces 

- Useful for exploring data in different ways

- I'll be using variables from the `state.x77` and `state.region` datasets (US state data from 1977)

```{r, fig.height = 3, fig.width = 6}
state.df <- data.frame(state.x77, state.region, state.abb)
state.fig <- ggplot(data = state.df, aes(x = Population, y = Area))
state.fig + geom_point()
```

---

## Aesthetics

You can increase the size of points using `size` argument within `geom_point()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Population, y = Area)) + geom_point(size = 3)
```

---

## Aesthetics

You can easily differentiate state region by <b>color</b> using the `color` argument within `aes()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Illiteracy, y = Murder, color = state.region)) + 
    geom_point(size = 2)
```

---

## Aesthetics

You can also differentiate state region by <b>color</b> and <b>shape</b> using the `shape` argument within `aes()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Life.Exp, y = HS.Grad, color = state.region, shape = state.region)) + 
    geom_point(size = 2)
```

--- 

## Your turn {data-background-color=#BA43B0}

- First, take a sample of 1000 rows from the `diamonds` dataset (pre-installed with R)

```{r}
d2 <- diamonds[sample(1:nrow(diamonds), 1000), ]
```

- Then, try to generate this plot using `ggplot()`:

```{r, fig.height = 3, fig.width = 6, echo = FALSE}
ggplot(data = d2, aes(x = carat, y = price, color = color)) + geom_point()
```

---

## Other geometric objects

- Type `geom_` and hit the tab key (`↹`) to see all possible geometries

- Then, use `?geom_` to view the help page

---

## Other geometric objects - Boxplot

```{r, fig.height = 3, fig.width = 6}
ggplot(iris, aes(x = Species,y = Sepal.Length)) + geom_boxplot()
```

---

## Other geometric objects - Histograms

Change some of the aesthetics, such as `binwidth`, `fill`

```{r, fig.height = 3, fig.width = 6}
ggplot(faithful, aes(x = waiting)) + 
    geom_histogram(binwidth = 8, color = "black", fill = "paleturquoise")
```

---

## Other geometric objects - Bar plots 

```{r, fig.height = 3, fig.width = 6}
ggplot(iris, aes(x = Species, y = Sepal.Length)) + 
    geom_bar(stat = "identity")
```

---

## Other geometric objects - Line plots 

```{r, fig.height = 3, fig.width = 6}
ggplot(mtcars, aes(x = wt, y = mpg, color = as.factor(cyl))) + geom_line()
```

---

## Other geometric objects - Density plots 

```{r, fig.height = 3, fig.width = 6}
ggplot(faithful, aes(waiting)) + geom_density(fill = "thistle")
```

--- 

## Your turn {data-background-color=#BA43B0}

1. Make a histogram of `Sepal.Length` from the `iris` data set. What did it do with the different species?

---

## Facets

- Plots can also have <b>facets</b>, which divide a plot into subplots based on a factor
- The syntax is `facet_grid(Species ~ .)`, where there are as many rows as species and there is only one column (represented by the period)

```{r, fig.height = 3, fig.width = 5, message = FALSE}
ggplot(iris, aes(Sepal.Length)) + geom_histogram() + 
    facet_grid(Species ~ .)
```

---

## Facets

Switch to `facet_grid(. ~ Species)` in order to get one row and three columns

```{r, fig.height = 3, fig.width = 7, message = FALSE}
ggplot(iris, aes(Sepal.Length)) + geom_histogram() + 
    facet_grid(. ~ Species)
```

---

## Stats 

Type `stat_` and hit the tab key (`↹`) to see them all. Then, use `?stat_` to see the help screen.

---

## Stats 

Use `stat_smooth` to add a linear fit

```{r, fig.height = 3, fig.width = 6}
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) + 
    geom_point() + stat_smooth(method = "lm")
```

---

## Scales

- `scales` are used to modify axes and colors 
- For example: 
  - `scale_y_continuous()`: Set name, breaks, labels, and limits of y-axis 
  - `scale_x_log10()`: log transform the x-axis 
  - `scale_colour_manual()`: Specify colors for geoms 
  - `scale_fill_discrete()`: Specify colors for geoms 

---

## Scales

Include log x and log y axes using `scale_x_log10()` and `scale_y_log10()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Population, y = Area, color = state.region)) + 
    geom_point() + scale_y_log10() + scale_x_log10()
```

---

## Scales

Add color manually using `scale_colour_manual()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Population, y = Area, color = state.region)) + 
    geom_point() + 
    scale_y_log10() + scale_x_log10() + 
    scale_colour_manual(values = c("palegreen3","palevioletred3","peachpuff3", "paleturquoise3"))
```

---

## Labels

Add labels, including x- and y-axis labels, using `labs()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Life.Exp, y = HS.Grad, color = state.region, shape = state.region)) +
    geom_point(size = 2) + 
    labs(x = "Life expectancy (in years)", y = "High school graduation rate (percent)")
```

---

## Labels

Add labels inside the figure using `geom_text()`

```{r, fig.height = 3, fig.width = 6}
ggplot(data = state.df, aes(x = Life.Exp, y = HS.Grad, color = state.region, shape = state.region)) +
    geom_point(size = 2) + 
    labs(x = "Life expectancy (in years)", y = "High school graduation rate (percent)") + 
    geom_text(aes(label = state.abb, size = 2, hjust = 0, vjust = 0))
```

---

## Themes 

- You can use <b>themes</b> to control the aesthetics of the figure -- see `?theme` for all of the options 
- I prefer `theme_bw()` (white background with gridlines) or `theme_classic()` (white background without gridlines)
- You can also change the overall font family and font size

```{r, fig.height = 3, fig.width = 6}
ggplot(iris, aes(Species, Sepal.Length)) + 
    geom_bar(stat = "identity") + 
    theme_classic() +
    theme(text = element_text(family = "Serif", size = 14))
```

---

## Saving plots

- Plots created with `ggplot2` can be saved using the `ggsave()` function
- The file type is determined by the file extension, and you can also specify the file name, dimensions, resolution, etc.
- Figures are saved in your current working directory unless you specify the complete file path with the `filename` argument

```{r, fig.height = 3, fig.width = 6, eval = FALSE}
iris.fig <- ggplot(iris, aes(Species, Sepal.Length)) + 
    geom_bar(stat = "identity") + theme_bw()
ggsave(filename = "IrisFigure.png", iris.fig, dpi = 600, height = 4, width = 4, units = "in")
```

---

## R Tip: ggplot2 uses data frames {data-background-color=#66BA43}

Your data structure must be a data frame (or comparable format) in order to plot with ggplot2

```{r,  fig.height = 3, fig.width = 5}
xvar <- rnorm(100)
yvar <- rnorm(100)
df <- data.frame(xvar, yvar)  # coerce to data frame 
ggplot(df, aes(xvar, yvar)) + geom_point()
```

---

## Proper data formatting 

- Sometimes data looks like this, with multiple observations in each row (<b>wide</b>-format)

```{r, echo = FALSE}
spp.df.wide <- data.frame(SpeciesA = rnorm(100, 50, 1), SpeciesB = rnorm(100, 75, 5), 
                          SpeciesC = rnorm(100, 20, 0.5), SpeciesD = rnorm(100, 25, 0.75))
```

```{r}
head(spp.df.wide)
dim(spp.df.wide)
```

---

## Proper data formatting 

- Data is much easier to analyze visually and statistically if it looks like this (<b>long</b>-format), with only one row per observation

```{r, echo = FALSE}
spp.df.long <- data.frame(Species = rep(c("A", "B", "C", "D"), 100), Mass = rnorm(400, 75, 5))
```

```{r}
head(spp.df.long)
dim(spp.df.long)
```

---

## Melting: from wide to long 

```{r}
# make some fake wide-format data
test.df.wide <- data.frame(A = rnorm(100, 50, 6), B = rnorm(100, 75, 5), 
                           C = rnorm(100, 50, 4), D = rnorm(100, 55, 3))
head(test.df.wide)
```

---

## Melting: from wide to long 

Use the `melt()` function in `reshape2` package

```{r, message = FALSE}
library(reshape2)
test.df.long <- melt(data = test.df.wide, variable.name = "Species", value.name = "Mass")
head(test.df.long)
dim(test.df.long)
```

---

## Melting: from wide to long 

Melting the data makes it easier to plot with `ggplot2`

```{r, fig.height = 3, fig.width = 6, comment = FALSE}
ggplot(test.df.long, aes(x = Mass)) + geom_histogram() + facet_grid(. ~ Species)
```

---

## Helpful links

<a href = "https://ggplot2.tidyverse.org/" target = "_blank">ggplot2 documentation</a>

<a href = "https://rstudio.github.io/cheatsheets/html/data-visualization.html" target = "_blank">ggplot Cheat Sheet</a>

<a href = "http://colorbrewer2.org" target = "_blank">R ColorBrewer</a>

<a href = "http://rpubs.com/mccannecology/47829" target = "_blank">Plotting means and error bars</a>

<a href = "http://www.cookbook-r.com/Graphs/" target = "_blank">R Cookbook: Graphs</a>

---

## Practice {data-background-color=#4387BA}

<a href = "https://rpubs.com/mccannecology/53357" target = "_blank">Worksheet</a>

<a href = "https://rpubs.com/mccannecology/53363" target = "_blank">Answers</a>

---

## Additional topics and links

- When you get a bit more comfortable with R, I recommend taking a look at the additional material on Mike McCann's website.

<a href = "http://rpubs.com/mccannecology/53465" target = "_blank">Reproducible Research with RMarkdown</a>

<a href = "https://rpubs.com/mccannecology/54011" target = "_blank">Advanced Data Manipulation with dplyr</a>

- I also recommend creating a GitHub account (where I've uploaded this course). GitHub is used for making code freely available as well as for version control (important for collaborating on projects)

<a href = "http://www.github.com" target = "_blank">GitHub</a>

<a href = "http://jonlefcheck.net/2013/11/04/a-basic-tutorial-to-version-control-using-git/" target = "_blank">Basic tutorial on using GitHub (with RStudio)</a>

<a href = "https://try.github.io" target = "_blank">GitHub tutorial (using command line)</a>

<a href = "#/2"> Back to the directory </a>
